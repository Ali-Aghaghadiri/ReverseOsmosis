# Reverse Osmosis
log log/log.equilibrium.lammps

# Initialization
kim        init  LJ_ElliottAkerson_2015_Universal__MO_959249795837_003  real
dimension  3
boundary   p p p
atom_style full

# Simulation Variables
variable PV  equal 0.1  # Velocity of the piston movement.
variable TS  equal 0.1  # Time Step for simulations.

variable T   equal 298.15  # Tempreture
variable ZL  equal 6.45    # start of the liquid region.
variable ZH  equal 25.0    # end of the liquid region.

variable dx  equal (${ZH}-${ZL})*3/4  # delta x: required piston displacement.
variable TTS equal floor(${dx}/(${PV}*${TS}))  # Total Time Step

# System Definition
read_data system/equilibrium.system.data

kim interactions  C Ca Cl H N Na O Ti

neigh_modify one 10000

# Define Groups
group C    type  1   
group H    type  4   
group N    type  5   
group O    type  7   
group Ti   type  8   
group H2O  type  7 4
group Ions type  6 3 2

region piston block  INF INF  INF INF  ${ZH} INF
region liquid block  INF INF  INF INF  ${ZL} ${ZH}
region bottom block  INF INF  INF INF  INF   ${ZL}

group bottom region  bottom
group piston region  piston
group liquid region  liquid

# Settings
velocity all create  $T 49284  dist gaussian  rot yes

fix NVE  all  nve
fix MEMBRANE  bottom  setforce     0.0  0.0  0.0
fix PISTON    piston  move linear  0.0  0.0 -${PV}

# Visualization
dump        1 all      xyz 50 visual/reverse.osmosis.xyz
dump_modify 1 element  C Ca Cl HW N Na OW Ti

# Simulation
timestep     ${TS}
thermo       100
thermo_style multi
run          ${TTS}

# Statistics and Informations
# compute     H2O_count   H2O  reduce/region  bottom
# compute     Ions_count  Ions reduce/region  bottom

# Finalization
write_restart system/RO.system.rest
write_data    system/RO.system.data
