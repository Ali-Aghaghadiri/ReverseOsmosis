# NPT Equilibrium
log log/log.equilibrium.lammps

# Initialization
kim        init  LJ_ElliottAkerson_2015_Universal__MO_959249795837_003  real
dimension  3
boundary   p p p
atom_style full

# Variables
variable ZL      equal 6.45     # start of the liquid region.
variable ZH      equal 25.0     # end of the liquid region.

variable T       equal 298.15   # Room tempreture.
variable P       equal 1.0      # Pressure.

variable TD      equal 100.0    # Temperature Damping Rate for NPT and NVT fixes.
variable PD      equal 1000.0   # Pressure Damping Rate for NPT fix.

variable TS equal 2             # Time Step in femto-seconds

# variable TE      equal 1.0e-8   # Minimizatin Total Energy
# variable TF      equal 1.0e-10  # Minimizatin Total Force
# variable MaxIter equal 1000     # Minimizatin Maximum Iteration
# variable MaxEval equal 10000    # Minimizatin Maximum Evaluation

# System Definition
# read_data system/system.data
read_data test.system.data

kim interactions C Ca Cl H N Na O Ti

neigh_modify one 10000

# Define Region/Groups
region piston block  INF INF  INF INF  ${ZH} INF
region liquid block  INF INF  INF INF  ${ZL} ${ZH}
region bottom block  INF INF  INF INF  INF   ${ZL}

group bottom region  bottom
group piston region  piston
group liquid region  liquid

# Settings
velocity all create  $T 49284  dist gaussian  rot yes

fix MEMBRANE bottom  setforce  0.0  0.0  0.0
fix PISTON   piston  setforce  0.0  0.0  0.0

timestep     ${TS}
thermo       100
thermo_style multi

# Visualization
dump        1 all      xyz 50 visual/equilibrium.xyz
dump_modify 1 element  C Ca Cl HW N Na OW Ti

# NPT Equilibrium
fix      NPT  all  npt  temp $T $T ${TD}  iso $P $P ${PD}
# minimize ${TE} ${TF} ${MaxIter} ${MaxEval}
run 600000  # 600 ps
unfix    NPT

# NVT Equilibrium
fix      NVT  all  nvt  temp $T $T ${TD}
# minimize ${TE} ${TF} ${MaxIter} ${MaxEval}
run 600000  # 600 ps
unfix    NVT

# NVE Equilibrium
fix      NVE  all  nve
# minimize ${TE} ${TF} ${MaxIter} ${MaxEval}
run 600000  # 600 ps
unfix    NVE

# Finalization
write_restart system/NPT.system.rest
write_data    system/equilibrium.system.data
